<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Attendance</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
--primary: #007bff;
--bg: #f0f4f8;
--white: #ffffff;
--gray: #ccc;
--shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
body {
font-family: Arial, sans-serif;
margin: 0;
padding: 10px;
background-color: var(--bg);
}
header {
display: flex;
justify-content: space-between;
align-items: center;
background: var(--white);
padding: 15px 10px;
border-radius: 10px;
box-shadow: var(--shadow);
margin-bottom: 10px;
}
h2 {
font-size: 20px;
margin: 0;
color: var(--primary);
}
.btn {
width: 100%;
background-color: #007bff;
color: white;
padding: 12px;
font-size: 16px;
border: none;
border-radius: 10px;
cursor: pointer;
}
.back-btn {
width: 100%;
background-color: #007bff;
color: white;
padding: 12px;
font-size: 16px;
border: none;
border-radius: 10px;
cursor: pointer;
}
.top-controls {
display: flex;
flex-wrap: wrap;
gap: 10px;
margin-bottom: 15px;
}
input[type="date"], select {
padding: 10px;
font-size: 14px;
border: 1px solid var(--gray);
border-radius: 6px;
flex: 1;
min-width: 130px;
}
label {
font-size: 14px;
display: flex;
align-items: center;
gap: 5px;
margin-top: 5px;
}
.student-list {
margin-bottom: 20px;
}
.student-card {
background: var(--white);
padding: 12px 15px;
margin-bottom: 10px;
border-radius: 10px;
box-shadow: var(--shadow);
display: flex;
justify-content: space-between;
align-items: center;
flex-wrap: wrap;
}
.student-name {
font-weight: bold;
font-size: 15px;
}
.status-message {
background: #28a745;
color: white;
text-align: center;
padding: 10px;
border-radius: 6px;
margin-top: 10px;
}
@media (max-width: 600px) {
.student-card {
flex-direction: column;
align-items: flex-start;
}
.student-card input[type="checkbox"] {
align-self: flex-end;
margin-top: 8px;
}
}
</style>
</head>
<body>
<header>
<h2>Attendance</h2>
</header>
<div class="top-controls">
<input type="date" id="attendanceDate">
<select id="dayFilter">
<option value="">All Days</option>
<option value="Monday">Monday</option>
<option value="Tuesday">Tuesday</option>
<option value="Wednesday">Wednesday</option>
<option value="Thursday">Thursday</option>
<option value="Friday">Friday</option>
<option value="Saturday">Saturday</option>
<option value="Sunday">Sunday</option>
</select>
<label><input type="checkbox" id="markAll" onchange="markAllPresent()"> Mark All Present</label>
</div>
<div id="studentList" class="student-list">
</div>
<button class="btn" onclick="saveAttendance()">Submit Attendance</button>
<button class="btn back-btn" onclick="window.history.back()"style="margin-top: 12px;">⬅️ Back</button>
<script>
const SUPABASE_URL = 'https://ndishfwnkzdedfcywcle.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5kaXNoZndua3pkZWRmY3l3Y2xlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwOTk0MjcsImV4cCI6MjA3MTY3NTQyN30.CXQSfhR0MVLF40v2Tp-BcENBpHpPshG9Ys3zLYiBQaM';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
//Check for an active session. If none exists, redirect to the login page.
async function checkUserSession() {
const { data: { session } } = await supabase.auth.getSession();
if (!session) {
window.location.href = 'index.html'; // Assuming 'index.html' is your login page
}
}
checkUserSession(); // Run the check immediately on page load
//Set today's date
document.getElementById('attendanceDate').valueAsDate = new Date();
//Load students from Supabase
async function loadStudents() {
try {
const selectedDay = document.getElementById('dayFilter').value;
let query = supabase.from('students').select('id, name, day');
const { data: students, error } = await query;
if (error) throw error;
const filtered = selectedDay
? students.filter(s => Array.isArray(s.day) && s.day.includes(selectedDay))
: students;
await displayStudents(filtered);
} catch (error) {
showMessage('Error loading students: ' + error.message);
}
}
//Display students and their attendance status
async function displayStudents(students) {
const list = document.getElementById('studentList');
list.innerHTML = '';
if (students.length === 0) {
list.innerHTML = '<p>No students found</p>';
return;
}
const date = document.getElementById('attendanceDate').value;
//Fetch existing attendance records for the selected date
const { data: todaysRecords, error } = await supabase.from('attendance').select('student_id').eq('date', date);
if (error) {
showMessage('Error fetching attendance records: ' + error.message);
return;
}
const attendedStudents = todaysRecords.map(r => r.student_id);
students.forEach(student => {
const card = document.createElement('div');
card.className = 'student-card';
card.innerHTML = `
<div class="student-name" data-id="${student.id}">${student.name}</div>
<input type="checkbox" class="mark-present" data-id="${student.id}"
${attendedStudents.includes(student.id) ? 'checked' : ''}>
`;
list.appendChild(card);
});
}
function markAllPresent() {
const checked = document.getElementById('markAll').checked;
document.querySelectorAll('.mark-present').forEach(cb => cb.checked = checked);
}
async function saveAttendance() {
try {
const date = document.getElementById('attendanceDate').value;
const { data: { user } } = await supabase.auth.getSession();
if (!date) return showMessage('Please select a date');
const checkboxes = document.querySelectorAll('.mark-present');
const recordsToSave = [];
checkboxes.forEach(cb => {
if (cb.checked) {
recordsToSave.push({
date: date,
student_id: cb.dataset.id,
status: 'Present',
user_id: user.id
});
}
});
//Supabase handles upsert, which will either insert new records or update existing ones
const { error } = await supabase.from('attendance').upsert(recordsToSave, {
onConflict: 'date, student_id, user_id'
});
if (error) throw error;
showMessage('Attendance saved successfully!');
} catch (e) {
showMessage('Error saving attendance: ' + e.message);
}
}
function showMessage(msg) {
const old = document.querySelector('.status-message');
if (old) old.remove();
const el = document.createElement('div');
el.className = 'status-message';
el.textContent = msg;
document.body.appendChild(el);
setTimeout(() => el.remove(), 3000);
}
document.getElementById('dayFilter').addEventListener('change', loadStudents);
document.getElementById('attendanceDate').addEventListener('change', loadStudents);
loadStudents();
</script>
</body>
</html>