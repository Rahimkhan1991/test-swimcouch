<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>View Students</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body {
font-family: sans-serif;
margin: 0;
padding: 1rem;
background: #f4f4f4;
}
h2 {
text-align: center;
color: #007bff;
}
.student-card {
background: #fff;
border-radius: 10px;
padding: 1rem;
margin: 1rem 0;
box-shadow: 0 4px 6px rgba(0,0,0,0.1);
display: flex;
align-items: center;
justify-content: space-between;
flex-wrap: wrap;
}
.student-info {
flex: 1;
min-width: 200px;
}
.student-photo {
width: 60px;
height: 60px;
border-radius: 50%;
object-fit: cover;
margin-right: 1rem;
border: 2px solid #ccc;
}
.student-header {
display: flex;
align-items: center;
margin-bottom: 0.5rem;
}
.pill {
background: #d1ecf1;
color: #0c5460;
padding: 4px 10px;
border-radius: 20px;
margin: 2px 4px 2px 0;
font-size: 0.8rem;
}
.buttons {
margin-top: 0.5rem;
}
.buttons button {
margin-right: 8px;
padding: 5px 10px;
border: none;
border-radius: 6px;
cursor: pointer;
}
.edit-btn {
background-color: #ffc107;
color: #000;
}
.delete-btn {
background-color: #dc3545;
color: #fff;
}
/* Modal styles */
.modal {
display: none;
position: fixed;
top: 0; left: 0;
width: 100%; height: 100%;
background: rgba(0,0,0,0.5);
justify-content: center;
align-items: center;
}
.modal-content {
background: white;
padding: 1rem;
border-radius: 10px;
width: 80%;
max-width: 400px;
}
.modal-content input {
width: 90%;
margin: 0.5rem 0;
padding: 6px;
}
.days-checkboxes label {
display: inline-block;
margin: 4px;
}
.modal-buttons {
margin-top: 1rem;
text-align: right;
}
.modal-buttons button {
margin-left: 0.5rem;
padding: 5px 10px;
}
.close-btn {
background: #ccc;
}
.save-btn {
background: #28a745;
color: white;
}
</style>
</head>
<body>
<h2>All Students</h2>
<div id="studentList"></div>
<div id="editModal" class="modal">
<div class="modal-content">
<h3>Edit Student</h3>
<input type="text" id="editName" placeholder="Name">
<input type="text" id="editPhone" placeholder="Phone">
<input type="number" id="editTotalFee" placeholder="Total Fee">
<input type="number" id="editInitialPayment" placeholder="Initial Payment">
<div class="days-checkboxes">
<label><input type="checkbox" value="Monday"> Mon</label>
<label><input type="checkbox" value="Tuesday"> Tue</label>
<label><input type="checkbox" value="Wednesday"> Wed</label>
<label><input type="checkbox" value="Thursday"> Thu</label>
<label><input type="checkbox" value="Friday"> Fri</label>
<label><input type="checkbox" value="Saturday"> Sat</label>
<label><input type="checkbox" value="Sunday"> Sun</label>
</div>
<div class="modal-buttons">
<button class="close-btn" onclick="closeModal()">Cancel</button>
<button class="save-btn" onclick="saveEdit()">Save</button>
</div>
</div>
</div>
<script>
const SUPABASE_URL = 'https://ndishfwnkzdedfcywcle.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5kaXNoZndua3pkZWRmY3l3Y2xlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwOTk0MjcsImV4cCI6MjA3MTY3NTQyN30.CXQSfhR0MVLF40v2Tp-BcENBpHpPshG9Ys3zLYiBQaM';
const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
let currentStudentId = null;
//Check for an active session. If none exists, redirect to the login page.
async function checkUserSession() {
const { data: { session } } = await supabase.auth.getSession();
if (!session) {
window.location.href = 'index.html'; // Assuming 'index.html' is your login page
}
}
checkUserSession(); // Run the check immediately on page load
// Renders student cards by fetching data from Supabase
async function renderStudents() {
const studentList = document.getElementById("studentList");
studentList.innerHTML = "";
const { data: students, error: studentsError } = await supabase.from('students').select('*');
if (studentsError) {
console.error('Error fetching students:', studentsError.message);
studentList.innerHTML = '<p>Error loading students.</p>';
return;
}
if (students.length === 0) {
studentList.innerHTML = '<p>No students found.</p>';
return;
}
// Fetch all fees to calculate balance
const { data: fees, error: feesError } = await supabase.from('fees').select('student_id, amount');
if (feesError) {
console.error('Error fetching fees:', feesError.message);
}
const feeMap = {};
if (fees) {
fees.forEach(fee => {
feeMap[fee.student_id] = (feeMap[fee.student_id] || 0) + fee.amount;
});
}
students.forEach(student => {
const card = document.createElement("div");
card.className = "student-card";
const info = document.createElement("div");
info.className = "student-info";
const namePhone = document.createElement("div");
namePhone.innerHTML = `<strong>${student.name}</strong><br><small>${student.phone}</small>`;
info.appendChild(namePhone);
const totalPaid = feeMap[student.id] || 0;
const total = parseFloat(student.totalFee) || 0;
const pending = Math.max(total - totalPaid, 0);
const feeInfo = document.createElement("div");
feeInfo.innerHTML = `
üí∞ Total Fee: ${total}<br>
üíµ Paid: ${totalPaid}<br>
üßæ Balance: ${pending}
`;
info.appendChild(feeInfo);
const dayContainer = document.createElement("div");
const days = Array.isArray(student.day) ? student.day : [student.day];
days.filter(Boolean).forEach(day => {
const pill = document.createElement("span");
pill.className = "pill";
pill.textContent = day;
dayContainer.appendChild(pill);
});
info.appendChild(dayContainer);
const actions = document.createElement("div");
actions.className = "buttons";
actions.innerHTML = `
<button class="edit-btn" onclick="openEditModal('${student.id}')">Edit</button>
<button class="delete-btn" onclick="deleteStudent('${student.id}')">Delete</button>
`;
info.appendChild(actions);
card.appendChild(info);
studentList.appendChild(card);
});
}
// Delete student from Supabase
async function deleteStudent(studentId) {
if (confirm("Are you sure you want to delete this student? This will also delete related fees and attendance records.")) {
// Delete related records first due to foreign key constraints
await supabase.from('fees').delete().eq('student_id', studentId);
await supabase.from('attendance').delete().eq('student_id', studentId);
const { error } = await supabase.from('students').delete().eq('id', studentId);
if (error) {
alert("Error deleting student: " + error.message);
} else {
alert("Student deleted successfully!");
renderStudents();
}
}
}
// Open modal with student data from Supabase
async function openEditModal(studentId) {
currentStudentId = studentId;
const { data: student, error } = await supabase.from('students').select('*').eq('id', studentId).single();
if (error) {
alert("Error fetching student data: " + error.message);
return;
}
document.getElementById("editName").value = student.name || "";
document.getElementById("editPhone").value = student.phone || "";
document.getElementById("editTotalFee").value = student.totalFee || "";
document.getElementById("editInitialPayment").value = student.initialPayment || "";
document.querySelectorAll(".days-checkboxes input").forEach(cb => cb.checked = false);
const days = Array.isArray(student.day) ? student.day : [student.day];
days.forEach(day => {
const cb = document.querySelector(`.days-checkboxes input[value="${day}"]`);
if (cb) cb.checked = true;
});
document.getElementById("editModal").style.display = "flex";
}
function closeModal() {
document.getElementById("editModal").style.display = "none";
}
// Save edits to Supabase
async function saveEdit() {
const name = document.getElementById("editName").value;
const phone = document.getElementById("editPhone").value;
const totalFee = parseFloat(document.getElementById("editTotalFee").value) || 0;
const initialPayment = parseFloat(document.getElementById("editInitialPayment").value) || 0;
const balanceFee = totalFee - initialPayment;
const selectedDays = [];
document.querySelectorAll(".days-checkboxes input:checked").forEach(cb => {
selectedDays.push(cb.value);
});
const updatedStudent = {
name: name,
phone: phone,
totalFee: totalFee,
initialPayment: initialPayment,
balanceFee: balanceFee,
day: selectedDays
};
const { error } = await supabase.from('students').update(updatedStudent).eq('id', currentStudentId);
if (error) {
alert("Error saving changes: " + error.message);
} else {
alert("Student updated successfully!");
closeModal();
renderStudents();
}
}
// Initial render
renderStudents();
</script>
<div style="text-align:center; margin-top: 30px;">
<button onclick="history.back()" style="
width: 100%;
background-color: #007bff;
color: white;
padding: 12px;
font-size: 16px;
border: none;
border-radius: 10px;
cursor: pointer;
">‚¨ÖÔ∏è Back</button>
</div>
</body>
</html>