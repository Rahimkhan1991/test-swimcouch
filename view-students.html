<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>View Students</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f4f4f4;
    }

    h2 {
      text-align: center;
      color: #007bff;
    }

    .student-card {
      background: #fff;
      border-radius: 10px;
      padding: 1rem;
      margin: 1rem 0;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .student-info {
      flex: 1;
      min-width: 200px;
    }

    .student-photo {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 1rem;
      border: 2px solid #ccc;
    }

    .student-header {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .pill {
    
      background: #d1ecf1;
      color: #0c5460;
      padding: 4px 10px;
      border-radius: 20px;
      margin: 2px 4px 2px 0;
      font-size: 0.8rem;
    }

    .buttons {
      margin-top: 0.5rem;
    }

    .buttons button {
      margin-right: 8px;
      padding: 5px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .edit-btn {
      background-color: #ffc107;
      color: #000;
    }

    .delete-btn {
      background-color: #dc3545;
      color: #fff;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      padding: 1rem;
      border-radius: 10px;
      width: 80%;
      max-width: 400px;
    }

    .modal-content input {
      width: 90%;
      margin: 0.5rem 0;
      padding: 6px;
    }

    .days-checkboxes label {
      display: inline-block;
      margin: 4px;
    }

    .modal-buttons {
      margin-top: 1rem;
      text-align: right;
    }

    .modal-buttons button {
      margin-left: 0.5rem;
      padding: 5px 10px;
    }

    .close-btn {
      background: #ccc;
    }

    .save-btn {
      background: #28a745;
      color: white;
    }
  </style>
</head>
<body>
  <h2>All Students</h2>
  <div id="studentList"></div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <h3>Edit Student</h3>
      <input type="text" id="editName" placeholder="Name">
      <input type="text" id="editPhone" placeholder="Phone">
      <input type="number" id="editTotalFee" placeholder="Total Fee">
      <input type="number" id="editInitialPayment" placeholder="Initial Payment">
      <div class="days-checkboxes">
        <label><input type="checkbox" value="Monday"> Mon</label>
        <label><input type="checkbox" value="Tuesday"> Tue</label>
        <label><input type="checkbox" value="Wednesday"> Wed</label>
        <label><input type="checkbox" value="Thursday"> Thu</label>
        <label><input type="checkbox" value="Friday"> Fri</label>
        <label><input type="checkbox" value="Saturday"> Sat</label>
        <label><input type="checkbox" value="Sunday"> Sun</label>
      </div>
      <div class="modal-buttons">
        <button class="close-btn" onclick="closeModal()">Cancel</button>
        <button class="save-btn" onclick="saveEdit()">Save</button>
      </div>
    </div>
  </div>

  <script>
    let editIndex = null;

    function renderStudents() {
      const studentList = document.getElementById("studentList");
      const students = JSON.parse(localStorage.getItem("students")) || [];
      studentList.innerHTML = "";

      students.forEach((student, index) => {
        const card = document.createElement("div");
        card.className = "student-card";

        const info = document.createElement("div");
        info.className = "student-info";

        const header = document.createElement("div");
        header.className = "student-header";

       

        const namePhone = document.createElement("div");
        namePhone.innerHTML = `<strong>${student.name}</strong><br><small>${student.phone}</small>`;

        
        header.appendChild(namePhone);
        info.appendChild(header);

      const total = parseFloat(student.totalFee) || 0;

// Get all fee payments for this student from localStorage
const fees = JSON.parse(localStorage.getItem("fees")) || [];
const studentFees = fees.filter(fee => fee.studentId == student.id);
const totalPaid = studentFees.reduce((sum, f) => sum + f.amount, 0);
const pending = Math.max(total - totalPaid, 0);

     const feeInfo = document.createElement("div");
feeInfo.innerHTML = `
  üí∞ Total Fee: Rp${total}<br>
  üíµ Paid: Rp${totalPaid}<br>
  üßæ Balance: Rp${pending}
`;

        info.appendChild(feeInfo);

        const dayContainer = document.createElement("div");
        const days = Array.isArray(student.day) ? student.day : [student.day];
        days.filter(Boolean).forEach(day => {
          const pill = document.createElement("span");
          pill.className = "pill";
          pill.textContent = day;
          dayContainer.appendChild(pill);
        });
        info.appendChild(dayContainer);

        const actions = document.createElement("div");
        actions.className = "buttons";
        actions.innerHTML = `
          <button class="edit-btn" onclick="openEditModal(${index})">Edit</button>
          <button class="delete-btn" onclick="deleteStudent(${index})">Delete</button>
        `;
        info.appendChild(actions);

        card.appendChild(info);
        studentList.appendChild(card);
      });
    }

    function deleteStudent(index) {
      const students = JSON.parse(localStorage.getItem("students")) || [];
      if (confirm("Are you sure to delete this student?")) {
        students.splice(index, 1);
        localStorage.setItem("students", JSON.stringify(students));
        renderStudents();
      }
    }

    function openEditModal(index) {
      editIndex = index;
      const students = JSON.parse(localStorage.getItem("students")) || [];
      const student = students[index];

      document.getElementById("editName").value = student.name || "";
      document.getElementById("editPhone").value = student.phone || "";
      document.getElementById("editTotalFee").value = student.totalFee || "";
      document.getElementById("editInitialPayment").value = student.initialPayment || "";

      document.querySelectorAll(".days-checkboxes input").forEach(cb => cb.checked = false);
      const days = Array.isArray(student.day) ? student.day : [student.day];
      days.forEach(day => {
        const cb = document.querySelector(`.days-checkboxes input[value="${day}"]`);
        if (cb) cb.checked = true;
      });

      document.getElementById("editModal").style.display = "flex";
    }

    function closeModal() {
      document.getElementById("editModal").style.display = "none";
    }

    function saveEdit() {
      const students = JSON.parse(localStorage.getItem("students")) || [];
      const student = students[editIndex];

      student.name = document.getElementById("editName").value;
      student.phone = document.getElementById("editPhone").value;
      student.totalFee = parseFloat(document.getElementById("editTotalFee").value) || 0;
      student.initialPayment = parseFloat(document.getElementById("editInitialPayment").value) || 0;
      student.balanceFee = student.totalFee - student.initialPayment;

      const selectedDays = [];
      document.querySelectorAll(".days-checkboxes input:checked").forEach(cb => {
        selectedDays.push(cb.value);
      });
      student.day = selectedDays;

      students[editIndex] = student;
      localStorage.setItem("students", JSON.stringify(students));
      closeModal();
      renderStudents();
    }

    renderStudents();
  </script>

  <div style="text-align:center; margin-top: 30px;">
    <button onclick="history.back()" style="
      width: 100%;
      background-color: #007bff;
      color: white;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    ">‚¨ÖÔ∏è Back</button>
  </div>

</body>
</html>
